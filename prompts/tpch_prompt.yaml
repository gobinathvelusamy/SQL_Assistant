_type: prompt
input_variables:
  - input
template: |
  Given below are the table structures in the analytics database raw schema in the Snowflake cloud database:

  CREATE OR REPLACE TABLE PRESCRIPTION.PUBLIC.MEMBER_PRESCRIPTIONS (
    MEMBERS NUMBER(38,0),
    PROVIDER VARCHAR(16777216),
    MEDICATIONS VARCHAR(16777216),
    PRIMARY KEY (MEMBERS, PROVIDER, MEDICATIONS),
    FOREIGN KEY (MEMBERS) REFERENCES PRESCRIPTION.PUBLIC.MEMBERS(MEMBER_ID),
    FOREIGN KEY (PROVIDER) REFERENCES PRESCRIPTION.PUBLIC.PROVIDER_DETAILS(PROVIDER_ID),
    FOREIGN KEY (MEDICATIONS) REFERENCES PRESCRIPTION.PUBLIC.MEDICATION_DETAILS(MEDICATION_CODES)
  );

  CREATE OR REPLACE TABLE PRESCRIPTION.PUBLIC.MEDICATION_DETAILS (
    MEDICATION_CODES VARCHAR(16777216),
    DRUGGROUP VARCHAR(16777216),
    PRIMARY KEY (MEDICATION_CODES)
  );

  CREATE OR REPLACE TABLE PRESCRIPTION.PUBLIC.MEMBERS (
    MEMBER_ID NUMBER(38,0),
    GENDER VARCHAR(16777216),
    AGE NUMBER(38,0),
    PRIMARY KEY (MEMBER_ID)
  );

  CREATE OR REPLACE TABLE PRESCRIPTION.PUBLIC.PROVIDER_DETAILS (
    PROVIDER_ID VARCHAR(16777216),
    SPECIALITY VARCHAR(16777216),
    QUALIFICATION VARCHAR(16777216),
    PRIMARY KEY (PROVIDER_ID)
  );

  Take user questions and respond back with an SQL query. Return the query in all capital letters. When asked for distribution, return the count of unique values.

  Example:
  User question: Who is the provider for member 6?
  Your generated SQL query: |
    SELECT "PROVIDER_DETAILS"."PROVIDER_ID"
    FROM "PRESCRIPTION"."PUBLIC"."MEMBER_PRESCRIPTIONS"
    JOIN "PRESCRIPTION"."PUBLIC"."PROVIDER_DETAILS" ON "MEMBER_PRESCRIPTIONS"."PROVIDER" = "PROVIDER_DETAILS"."PROVIDER_ID"
    WHERE "MEMBER_PRESCRIPTIONS"."MEMBERS" = 6;

  Example:
  User question: What is the name of the medication that has been prescribed to member 8?
  Your generated SQL query: |
    SELECT "MEDICATION_DETAILS"."DRUGGROUP"
    FROM "PRESCRIPTION"."PUBLIC"."MEMBER_PRESCRIPTIONS"
    JOIN "PRESCRIPTION"."PUBLIC"."MEDICATION_DETAILS" ON "MEMBER_PRESCRIPTIONS"."MEDICATIONS" = "MEDICATION_DETAILS"."MEDICATION_CODES"
    WHERE "MEMBER_PRESCRIPTIONS"."MEMBERS" = 8;

  Example:
  User question: How many members have consulted providers with qualification 'MD'?
  Your generated SQL query: |
    SELECT COUNT(DISTINCT A.MEMBERS) AS COUNT_MEMBERS 
    FROM PRESCRIPTION.PUBLIC.MEMBER_PRESCRIPTIONS A
    INNER JOIN PRESCRIPTION.PUBLIC.PROVIDER_DETAILS B ON A.PROVIDER = B.PROVIDER_ID
    WHERE B.QUALIFICATION = 'MD';

  Example:
  User question: What is the gender distribution for members who are on Druggroup 'AntiCoagulants' below the age of 50?
  Your generated SQL query: |
    SELECT A.GENDER, COUNT(DISTINCT A.MEMBERS) AS COUNT_MEMBERS
    FROM (
      SELECT A.MEMBERS, C.GENDER, B.MEDICATION_CODES, C.AGE
      FROM PRESCRIPTION.PUBLIC.MEMBER_PRESCRIPTIONS A
      LEFT JOIN PRESCRIPTION.PUBLIC.MEDICATION_DETAILS B ON A.MEDICATIONS = B.MEDICATION_CODES
      LEFT JOIN PRESCRIPTION.PUBLIC.MEMBERS C ON A.MEMBERS = C.MEMBER_ID
      WHERE B.DRUGGROUP = 'AntiCoagulants' AND C.AGE < 50
    ) A
    GROUP BY A.GENDER;

  User question: {input}
  Your generated SQL query: |
